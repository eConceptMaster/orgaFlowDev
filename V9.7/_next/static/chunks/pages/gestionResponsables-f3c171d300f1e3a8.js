(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{13452:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/gestionResponsables",function(){return a(28380)}])},28380:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(74848),r=a(93107),l=a(40350),i=a(96540),n=a(96967),o=a(18322);a(13084);var d=a(18382);class c extends i.Component{componentDidMount(){this.fetchData()}render(){let{data:e}=this.state;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"box-body space-y-3",children:(0,s.jsx)("div",{className:"overflow-hidden table-bordered",children:(0,s.jsxs)("div",{children:[this.isLoading&&(0,s.jsx)(d.Qv,{numberOfColumns:this.columns.length}),!this.isLoading&&(0,s.jsx)(n.ReactTabulator,{columns:this.columns,options:{pagination:"local",paginationSize:10,paginationSizeSelector:[10,20,50,100],paginationInitialPage:1,paginationButtonCount:5,paginationDataReceived:{last_page:1},paginationDataSent:{page:1,size:10}},events:{rowClick:this.rowClick},onRef:e=>{this.props.refTable(e)},data:e,"data-custom-attr":"test-custom-attribute",className:"ti-custom-table ti-striped-table ti-custom-table-hover"})]})})})})}constructor(e){super(e),this.isLoading=!0,this.handleNamePage=(e,t,a)=>{let{namePage:s,isActif:r,mainPage:l,infoChecking:i,idUser:n}=this.props;i(!0),s(e),r(!0),l(t),n(a)},this.columns=[{title:"Nom",field:"NOM"},{title:"Mail",field:"MAIL"},{title:"Telephone",field:"TELEPHONE"}],this.fetchData=async()=>{var e,t;let{result:a,loading:s}=await (0,o.Fd)("/responsables"),r=null!==(e=null==a?void 0:a.data)&&void 0!==e?e:null,l=null!==(t=null==a?void 0:a.error)&&void 0!==t?t:null;l&&console.error(l);let i=(null!=r?r:[]).map(e=>({ID:e.ID,NOM:"".concat(e.NOM," ").concat(void 0!==e.PRENOM?e.PRENOM:""),MAIL:e.MAIL,TELEPHONE:e.TELEPHONE?(0,o.fk)(String(e.TELEPHONE)):""}));this.setState({data:i}),this.props.dataTable(i),this.isLoading=s,setTimeout(()=>{let e=document.querySelector(".tabulator-page[title='First Page']"),t=document.querySelector(".tabulator-page[title='Prev Page']"),a=document.querySelector(".tabulator-page[title='Next Page']"),s=document.querySelector(".tabulator-page[title='Last Page']");e&&(e.textContent="Premi\xe8re"),t&&(t.textContent="Pr\xe9c\xe9dente"),a&&(a.textContent="Suivante"),s&&(s.textContent="Derni\xe8re")},10)},this.rowClick=(e,t)=>{this.handleNamePage("Info responsable","Info responsable",t.getData().ID)},this.clearData=()=>{this.setState({data:[]})},this.state={data:[]}}}a(77571);var u=a(18940),m=a(6861),b=a(11011);a(74148);var h=a(66503);let E=e=>{var t,a,r;let{namePage:l,isActif:n,mainPage:c,isChecking:E,setInfoChecking:N,idUser:p,setIdUser:g}=e,[x,v]=(0,i.useState)({}),[f,O]=(0,i.useState)(!0),[y,j]=(0,i.useState)(""),[L,C]=(0,i.useState)({NOM:"",NUMERO_RESPONSABLE:0,TELEPHONE:32,TYPE_CIVILITE:0,UID:""}),[S,I]=(0,i.useState)({NOM:"",NUMERO_RESPONSABLE:0,TELEPHONE:0,TYPE_CIVILITE:0,UID:""}),[T,P]=(0,i.useState)({ADRESSE:"",CODE_POSTAL:0,LOCALITE:"",NUMERO:""}),[A,M]=(0,i.useState)({ADRESSE:"",CODE_POSTAL:0,LOCALITE:"",NUMERO:""}),R=(e,t)=>{N(!1),n(!1),l(e),c(t),g("")},w=e=>{let{name:t,value:a,type:s}=e.target;v(e=>({...e,[t]:!1})),P(e=>({...e,[t]:"number"===s?Number(a):a}))},_=e=>{let{name:t,value:a,type:s}=e.target;v(e=>({...e,[t]:!1})),C(e=>({...e,[t]:"number"===s?Number(a):a}))},k=e=>{C(t=>({...t,TELEPHONE:Number(e)})),v(e=>({...e,TELEPHONE:!1}))},D=()=>{let e=u.EY.safeParse(T);if(!e.success){let t=e.error.flatten().fieldErrors;console.log(t);let a=Object.keys(t).reduce((e,t)=>(e[t]=!0,e),{});return v(e=>({...e,...a})),!1}return!0},U=()=>{let e=u.UG.safeParse(L);if(!e.success){let t=e.error.flatten().fieldErrors;return console.log(t),v({...Object.keys(t).reduce((e,t)=>(e[t]=!0,e),{})}),D(),!1}return D()},B=async()=>{if(U())try{let e={...L,ID:p},{error:t}=await (0,o.FI)("/responsables/",!1,e),{error:a}=await (0,o.FI)("/adresse/",!1,T);if(t){console.error(t);return}if(a){console.error(a);return}O(!1)}catch(e){console.error(e)}},H=async e=>{e.preventDefault();try{let e={...L,UID:String(Math.random())},t=u.UG.safeParse(e);if(!t.success){let e=t.error.flatten().fieldErrors,a=Object.keys(e).reduce((e,t)=>(e[t]=!0,e),{});v(a);return}let{error:a}=await (0,o.sS)("/responsables",!1,e);a||(C({ID:void 0,MAIL:void 0,NOM:"",NUMERO_RESPONSABLE:0,PRENOM:void 0,REGISTRE_NATIONAL:void 0,TELEPHONE:0,TYPE_CIVILITE:0,UID:""}),j(""))}catch(e){console.error(e)}},V=async()=>{try{let{error:e}=await (0,o.Wv)("/responsables/".concat(p));e||setTimeout(()=>R("Responsables",""),50)}catch(e){console.error(e)}},Y=(e,t)=>{var a;let s=String(e.TYPE_CIVILITE);C({NOM:e.NOM,PRENOM:e.PRENOM,REGISTRE_NATIONAL:e.REGISTRE_NATIONAL,TYPE_CIVILITE:e.TYPE_CIVILITE,NUMERO_RESPONSABLE:e.NUMERO_RESPONSABLE,UID:e.UID,TELEPHONE:e.TELEPHONE,MAIL:e.MAIL}),j(s?({0:"Gar\xe7on",1:"Fille",2:"Autres"})[s]:""),P({CODE_POSTAL:t.CODE_POSTAL,LOCALITE:t.LOCALITE,NUMERO:t.NUMERO,NUM_BOITE:null!==(a=t.NUM_BOITE)&&void 0!==a?a:"",ADRESSE:t.ADRESSE,ADRESSE_ID:t.ADRESSE_ID})},{result:F,loading:z}=(0,m.s)("/listtype/reference/type_civilite",!0),{result:G,loading:q}=(0,m.s)("/responsables/".concat(p)),{result:X,loading:J}=(0,m.s)("/adresse/responsable/".concat(p)),Q=z||q||J,W=null!==(t=null==G?void 0:G.data)&&void 0!==t?t:null,Z=null!==(a=null==X?void 0:X.data)&&void 0!==a?a:null,K=null!==(r=null==F?void 0:F.data)&&void 0!==r?r:null;return(0,i.useEffect)(()=>{W&&Z&&(Y(W,Z),O(!1))},[W,Z]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"grid grid-cols-12 gap-6",children:(0,s.jsx)("div",{className:"col-span-12",children:(0,s.jsxs)("div",{className:"box",children:[(0,s.jsx)("div",{className:"box-header",children:(0,s.jsxs)("button",{type:"button",className:"ti-btn !rounded-full ti-btn-outline-info",onClick:()=>R("Responsables",""),children:[(0,s.jsx)("i",{className:"ti ti-arrow-back font-bold"}),"Retour"]})}),(0,s.jsxs)("div",{className:"box-body",children:[Q&&(0,s.jsx)(d.eI,{}),!Q&&(0,s.jsxs)("form",{className:"ti-validation",children:[(0,s.jsxs)("fieldset",{children:[(0,s.jsx)("legend",{className:"text-xl font-semibold bg-white dark:dark:bg-bgdark px-3 translate-y-3 translate-x-3",children:"Informations personnelles"}),(0,s.jsx)("hr",{className:"mb-6"}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Nom"}),(0,s.jsx)("input",{type:"text",className:x.NOM?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"NOM",value:L.NOM,onChange:_,readOnly:!f,required:!0}),(0,m.B)(x.NUMERO_RESPONSABLE)]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Pr\xe9nom"}),(0,s.jsx)("input",{type:"text",className:"my-auto ti-form-input",name:"PRENOM",value:L.PRENOM,onChange:_,readOnly:!f})]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Num\xe9ro de responsable"}),(0,s.jsx)("input",{type:"number",className:x.NUMERO_RESPONSABLE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"NUMERO_RESPONSABLE",value:null===L.NUMERO_RESPONSABLE?"":L.NUMERO_RESPONSABLE,onChange:_,readOnly:!f}),(0,m.B)(x.NUMERO_RESPONSABLE)]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Civilit\xe9"}),(0,s.jsxs)("select",{className:x.TYPE_CIVILITE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"TYPE_CIVILITE",value:y,onChange:e=>{let t=e.target.selectedOptions[0];t&&(j(t.value),""!==y&&v(e=>({...e,TYPE_CIVILITE:!1})),C(e=>({...e,TYPE_CIVILITE:Number(t.dataset.type)})))},disabled:!f,defaultValue:"Choisir une civilit\xe9",children:[(0,s.jsx)("option",{children:"Choisir une civilit\xe9"}),K&&K.map(e=>(0,s.jsx)("option",{"data-type":e.ID_REFERENCE,children:e.LIBELLE_REFERENCE},e.ID))]}),(0,m.B)(x.TYPE_CIVILITE)]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Mail"}),(0,s.jsx)("input",{type:"email",className:x.MAIL?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"MAIL",value:null===L.MAIL?"":L.MAIL,onChange:_,readOnly:!f}),(0,m.B)(x.MAIL)]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"T\xe9l\xe9phone"}),(0,s.jsx)(b.LR,{defaultCountry:"be",value:String(L.TELEPHONE),onChange:e=>k(e),countries:h.X,className:"w-full",disabled:!f,inputClassName:x.TELEPHONE?"w-full dark:bg-bgdark !ml-[1px] !border-l !border-red-600":"w-full dark:bg-bgdark !border-[#e2e8f0]"}),(0,m.B)(x.TELEPHONE)]})]})]}),(0,s.jsxs)("fieldset",{className:"mt-6",children:[(0,s.jsx)("legend",{className:"text-xl font-semibold bg-white dark:dark:bg-bgdark px-3 translate-y-3 translate-x-3",children:"Adresse"}),(0,s.jsx)("hr",{className:"mb-6"}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Adresse"}),(0,s.jsx)("input",{type:"text",name:"ADRESSE",readOnly:!f,onChange:w,value:T.ADRESSE,className:x.ADRESSE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input"}),(0,m.B)(x.ADRESSE)]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Num\xe9ro"}),(0,s.jsx)("input",{type:"text",name:"NUMERO",readOnly:!f,onChange:w,value:T.NUMERO,className:x.NUMERO?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input"}),(0,m.B)(x.NUMERO)]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Boite"}),(0,s.jsx)("input",{type:"text",name:"NUM_BOITE",readOnly:!f,onChange:w,value:T.NUM_BOITE,className:"my-auto ti-form-input"})]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Code postal"}),(0,s.jsx)("input",{type:"number",name:"CODE_POSTAL",readOnly:!f,onChange:w,value:null===T.CODE_POSTAL?"":T.CODE_POSTAL,className:x.CODE_POSTAL?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input"}),(0,m.B)(x.CODE_POSTAL)]})]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Localit\xe9"}),(0,s.jsx)("input",{type:"text",name:"LOCALITE",readOnly:!f,onChange:w,value:T.LOCALITE,className:x.LOCALITE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input"}),(0,m.B)(x.LOCALITE)]})]})]}),(0,s.jsxs)("div",{children:[!E&&(0,s.jsx)("button",{type:"button",onClick:H,className:"mt-4 ti-btn ti-btn-primary",children:"Cr\xe9er"}),E&&!f&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-warning",onClick:()=>{O(!0),I({...L}),M({...T})},children:"Editer"}),E&&!f&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-danger","data-hs-overlay":"#deleteModal",children:"Supprimer"}),f&&E&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-success",onClick:B,children:"Valider"}),f&&E&&(0,s.jsx)("button",{type:"submit",className:"hs-dropdown-toggle ti-btn ti-border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:ring-offset-white focus:ring-primary dark:bg-bgdark dark:hover:bg-black/20 dark:border-white/10 dark:text-white/70 dark:hover:text-white dark:focus:ring-offset-white/10",onClick:()=>{O(!1),C({...S}),P({...A})},children:"Annuler"})]})]}),(0,s.jsx)("div",{id:"deleteModal",className:"hs-overlay hidden ti-modal",children:(0,s.jsx)("div",{className:"hs-overlay-open:mt-7 ti-modal-box mt-0 ease-out",children:(0,s.jsxs)("div",{className:"ti-modal-content",children:[(0,s.jsxs)("div",{className:"ti-modal-header",children:[(0,s.jsx)("h3",{className:"ti-modal-title",children:"Suppression de responsable"}),(0,s.jsxs)("button",{type:"button",className:"hs-dropdown-toggle ti-modal-close-btn","data-hs-overlay":"#deleteModal",children:[(0,s.jsx)("span",{className:"sr-only",children:"Fermer"}),(0,s.jsx)("svg",{className:"w-3.5 h-3.5",width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M0.258206 1.00652C0.351976 0.912791 0.479126 0.860131 0.611706 0.860131C0.744296 0.860131 0.871447 0.912791 0.965207 1.00652L3.61171 3.65302L6.25822 1.00652C6.30432 0.958771 6.35952 0.920671 6.42052 0.894471C6.48152 0.868271 6.54712 0.854471 6.61352 0.853901C6.67992 0.853321 6.74572 0.865971 6.80722 0.891111C6.86862 0.916251 6.92442 0.953381 6.97142 1.00032C7.01832 1.04727 7.05552 1.1031 7.08062 1.16454C7.10572 1.22599 7.11842 1.29183 7.11782 1.35822C7.11722 1.42461 7.10342 1.49022 7.07722 1.55122C7.05102 1.61222 7.01292 1.6674 6.96522 1.71352L4.31871 4.36002L6.96522 7.00648C7.05632 7.10078 7.10672 7.22708 7.10552 7.35818C7.10442 7.48928 7.05182 7.61468 6.95912 7.70738C6.86642 7.80018 6.74102 7.85268 6.60992 7.85388C6.47882 7.85498 6.35252 7.80458 6.25822 7.71348L3.61171 5.06702L0.965207 7.71348C0.870907 7.80458 0.744606 7.85498 0.613506 7.85388C0.482406 7.85268 0.357007 7.80018 0.264297 7.70738C0.171597 7.61468 0.119017 7.48928 0.117877 7.35818C0.116737 7.22708 0.167126 7.10078 0.258206 7.00648L2.90471 4.36002L0.258206 1.71352C0.164476 1.61976 0.111816 1.4926 0.111816 1.36002C0.111816 1.22744 0.164476 1.10028 0.258206 1.00652Z",fill:"currentColor"})})]})]}),(0,s.jsx)("div",{className:"ti-modal-body",children:(0,s.jsx)("p",{className:"mt-1 text-gray-800 dark:text-white/70",children:"\xcates-vous s\xfbr de vouloir supprimer ce responsable ?"})}),(0,s.jsxs)("div",{className:"ti-modal-footer",children:[(0,s.jsx)("button",{type:"button",className:"hs-dropdown-toggle ti-btn ti-btn-danger bg-danger font-medium shadow-sm align-middle hover:bg-danger/80 focus:ring-offset-white focus:ring-danger dark:bg-danger dark:hover:bg-danger/80 dark:focus:ring-offset-white/10","data-hs-overlay":"#deleteModal",onClick:V,children:"Supprimer"}),(0,s.jsx)("button",{type:"button",className:"hs-dropdown-toggle ti-btn ti-border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:ring-offset-white focus:ring-primary dark:bg-bgdark dark:hover:bg-black/20 dark:border-white/10 dark:text-white/70 dark:hover:text-white dark:focus:ring-offset-white/10","data-hs-overlay":"#deleteModal",children:"Annuler"})]})]})})})]})]})})})})},N=()=>{let[e,t]=(0,i.useState)("Responsables"),[a,n]=(0,i.useState)(""),[d,u]=(0,i.useState)(!1),[m,b]=(0,i.useState)(void 0),[h,N]=(0,i.useState)(void 0),[p,g]=(0,i.useState)(["NOM","MAIL","TELEPHONE"]),[x,v]=(0,i.useState)(!1),[f,O]=(0,i.useState)(""),y=(e,a)=>{t(e),u(!0),n(a)},j=(e,t,a,s)=>{let r=e.target.value.trim().toLowerCase(),l=(0,o.eV)(r);if(s.current){let e=r?a.filter(e=>t.some(t=>{var a;let s=null===(a=e[t])||void 0===a?void 0:a.toString().toLowerCase();return(0,o.eV)(s).includes(l)})):a;s.current.replaceData(e),s.current.redraw()}};return(0,s.jsxs)("div",{children:[(0,s.jsx)(l.A,{title:"Responsables"}),(0,s.jsx)(r.A,{currentpage:e,mainpage:a,activepage:"Gestion des responsables"}),(0,s.jsx)("div",{className:"grid grid-cols-12 gap-6",children:(0,s.jsxs)("div",{className:"col-span-12",children:[!d&&(0,s.jsxs)("div",{className:"box basic-data-table",children:[(0,s.jsxs)("div",{className:"box-header flex items-center ",children:[(0,s.jsxs)("button",{type:"button",className:"ti-btn !rounded-full ti-btn-outline-success mr-auto",onClick:()=>y("Ajouter un responsable","Ajouter un responsable"),children:[(0,s.jsx)("i",{className:"ti ti-plus font-bold"}),"Ajouter un responsable"]}),(0,s.jsx)("div",{className:"max-w-sm space-y-3",children:(0,s.jsxs)("div",{className:"flex rounded-sm",children:[(0,s.jsx)("input",{onChange:e=>j(e,p,m,h),placeholder:"Rerchercher...",type:"text",id:"hs-trailing-button-add-on-with-icon",name:"hs-trailing-button-add-on-with-icon",className:"ti-form-input rounded-none ltr:rounded-l-sm rtl:rounded-r-sm focus:z-10"}),(0,s.jsx)("button",{"aria-label":"button",type:"button",className:"inline-flex flex-shrink-0 justify-center   items-center h-[2.875rem] w-[2.875rem] ltr:rounded-r-sm rtl:rounded-l-sm border   border-transparent font-semibold bg-primary text-white hover:bg-primary focus:z-10   focus:outline-none focus:ring-0 focus:ring-primary transition-all text-sm",children:(0,s.jsx)("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0   1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})})]})})]}),(0,s.jsx)(c,{namePage:t,isActif:u,mainPage:n,infoChecking:v,idUser:O,dataTable:b,refTable:N})]}),d&&(0,s.jsx)(E,{namePage:t,isActif:u,mainPage:n,isChecking:x,setInfoChecking:v,idUser:f,setIdUser:O})]})})]})};N.layout="Contentlayout";let p=N},66503:(e,t,a)=>{"use strict";a.d(t,{X:()=>i,i:()=>n});var s=a(11011),r=a(50810),l=a(84477);r.registerLocale(l);let i=s.i4.map(e=>{let t=(0,s.Ot)(e);return t.name=r.getName(t.iso2,"fr")||t.name,(0,s.vg)(t)}),n=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"]},77571:()=>{},74148:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[374,518,718,150,476,230,328,30,636,593,792],()=>t(13452)),_N_E=e.O()}]);