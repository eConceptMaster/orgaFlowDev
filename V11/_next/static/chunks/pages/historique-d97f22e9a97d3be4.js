(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{97474:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/historique",function(){return t(46057)}])},46057:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>v});var r=t(74848),i=t(96540),a=t(40350),s=t(93107),n=t(6861),o=t(18382),c=t(18322),d=t(59386),u=t.n(d);t(77571);var x=t(66503),m=t(20757);let p=()=>{var e,l,t,p,v,h;let[f,g]=(0,i.useState)(null),[b,w]=(0,i.useState)(!1),[N,y]=(0,i.useState)(2025),[j,E]=(0,i.useState)(null),[k,S]=(0,i.useState)(null),[C,L]=(0,i.useState)(1),[O,A]=(0,i.useState)([]),[_,D]=(0,i.useState)("Tri par activit\xe9s"),[M,F]=(0,i.useState)(new Date),[I,R]=(0,i.useState)(!1),[T,q]=(0,i.useState)([]),[J,V]=(0,i.useState)({}),[H,P]=(0,i.useState)([]),[Y,B]=(0,i.useState)(null),z=(0,i.useRef)(null),X=(0,i.useRef)(null),Z={"Tri par activit\xe9s":1,"Tri par enfants":2,"Tri par mois":3};(0,d.registerLocale)("fr",m.A);let W=e=>e.reduce((e,l)=>{let{FRAIS_ID:t,ELEVE_ID:r,LIBELLE:i,DATE_FRAIS:a}=l;return e[t]||(e[t]={libelle:i,eleves:{}}),e[t].eleves[r]||(e[t].eleves[r]={dates:[]}),e[t].eleves[r].dates.push(a),e},{}),G=()=>1===C&&Y?Y.length:2===C&&H?H.length:3===C&&J?Object.keys(J).length:0,K=async(e,l)=>{var t,r,i,a,s,n;R(e=>!e);let{FirstDayOfMonth:o,LastDayOfMonth:d}=(0,c.ZH)(null!=l?l:M),u={ListeEleve:[e],Du:o,Au:d},{result:x,loading:m}=await (0,c.Fd)("/facturation/Activite/Frais",!1,u),{result:p,loading:v}=await (0,c.Fd)("/facturation/Activite/Historique",!1,u),h=null!==(t=null==p?void 0:p.data)&&void 0!==t?t:[],f=null!==(r=null==p?void 0:p.error)&&void 0!==r?r:null,g=null!==(i=null==x?void 0:x.data)&&void 0!==i?i:[],b=null!==(a=null==x?void 0:x.error)&&void 0!==a?a:null;if(f){alert(JSON.stringify(null===(s=f.response)||void 0===s?void 0:s.data));return}if(b){alert(JSON.stringify(null===(n=b.response)||void 0===n?void 0:n.data));return}P(g),q(h),A([]),m||v||R(e=>!e)},Q=async(e,l)=>{var t,r,i,a,s,n;R(e=>!e);let{FirstDayOfMonth:o,LastDayOfMonth:d}=(0,c.ZH)(null!=l?l:M),u={ListeFraisID:[e],Du:o,Au:d},{result:x,loading:m}=await (0,c.Fd)("/facturation/Activite/Eleves",!1,u),{result:p,loading:v}=await (0,c.Fd)("/facturation/Activite/Historique",!1,u),h=null!==(t=null==p?void 0:p.data)&&void 0!==t?t:[],f=null!==(r=null==p?void 0:p.error)&&void 0!==r?r:null,g=null!==(i=null==x?void 0:x.data)&&void 0!==i?i:[],b=null!==(a=null==x?void 0:x.error)&&void 0!==a?a:null;if(f){alert(JSON.stringify(null===(s=f.response)||void 0===s?void 0:s.data));return}if(b){alert(JSON.stringify(null===(n=b.response)||void 0===n?void 0:n.data));return}B(g.map(e=>e.ELEVE_ID)),q(h),A([]),m||v||R(e=>!e)},U=async e=>{var l,t,r,i,a,s;R(e=>!e);let{FirstDayOfMonth:n,LastDayOfMonth:o}=(0,c.ZH)(e),d={Du:n,Au:o},{result:u,loading:x}=await (0,c.Fd)("/facturation/Activite/Eleves",!1,d),{result:m,loading:p}=await (0,c.Fd)("/facturation/Activite/Historique",!1,d),v=null!==(l=null==m?void 0:m.data)&&void 0!==l?l:[],h=null!==(t=null==m?void 0:m.error)&&void 0!==t?t:null,f=null!==(r=null==u?void 0:u.data)&&void 0!==r?r:[],g=null!==(i=null==u?void 0:u.error)&&void 0!==i?i:null;if(h){alert(JSON.stringify(null===(a=h.response)||void 0===a?void 0:a.data));return}if(g){alert(JSON.stringify(null===(s=g.response)||void 0===s?void 0:s.data));return}let b=f.map(e=>e.ELEVE_ID),w=W(v);B(b),V(w),console.log(w),A([]),p||x||R(e=>!e)},$=e=>{A(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},ee=e=>{A(l=>l.length===e?[]:Array.from({length:e},(e,l)=>l))},el=e=>{F(e),f&&Q(f,e),k&&K(k,e)},et=e=>{let l=e.target;D(l.textContent),L(Z[l.textContent]),g(null),S(null),F(new Date),E(null),X.current&&(X.current.value=""),w(!1)},er=e=>{E(e),g(null),S(null);let l=new Date(new Date().getFullYear(),e,1);el(l),U(l)},ei=async e=>{S(e),g(null),E(null),A([]),K(e)},ea=async e=>{g(e),S(null),E(null),A([]),Q(e)};(0,i.useEffect)(()=>{let e=localStorage.getItem("annee");console.log(e),e&&y(Number(e))},[]);let{result:es,loading:en}=(0,n.s)("/frais/typefrais/2",!1,{AnneeScolaire:N}),{result:eo}=(0,n.s)("/eleves"),ec=null!==(e=null==es?void 0:es.data)&&void 0!==e?e:[],ed=null!==(l=null==eo?void 0:eo.data)&&void 0!==l?l:[],eu=null!==(t=null==es?void 0:es.error)&&void 0!==t?t:null,ex=null!==(p=null==eo?void 0:eo.error)&&void 0!==p?p:null;if(eu){alert(JSON.stringify(null===(v=eu.response)||void 0===v?void 0:v.data));return}if(ex){alert(JSON.stringify(null===(h=ex.response)||void 0===h?void 0:h.data));return}let em=Object.fromEntries(ed.map(e=>[e.ELEVE_ID,e]));return(0,r.jsxs)("div",{children:[(0,r.jsx)(a.A,{title:"Historique"}),(0,r.jsx)(s.A,{currentpage:"Historique",activepage:"Historique",mainpage:""}),(0,r.jsxs)("div",{className:"flex gap-6",children:[(0,r.jsxs)("div",{className:"box w-1/4",children:[(0,r.jsx)("div",{className:"box-header",children:(0,r.jsxs)("div",{className:"ti-dropdown m-1 w-full",children:[(0,r.jsx)("div",{className:"relative ti-dropdown-toggle rounded-none ltr:rounded-l-md rtl:rounded-r-md focus:z-10 w-full justify-start font-bold",children:_}),(0,r.jsxs)("div",{className:"ti-dropdown [--placement:right-top]",children:[(0,r.jsx)("button",{type:"button",className:"relative ti-dropdown-toggle rounded-none h-[2.875rem] w-[2.875rem] ltr:rounded-r-md rtl:rounded-l-md focus:z-10",onClick:()=>w(e=>!e),children:(0,r.jsx)("svg",{className:"w-auto h-2.5 ti-dropdown-caret  rtl:rotate-180",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M5 1L10.6869 7.16086C10.8637 7.35239 10.8637 7.64761 10.6869 7.83914L5 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),b&&(0,r.jsxs)("div",{className:"absolute -top-2 left-14 z-10 p-2 mt-2 w-60 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:[(0,r.jsx)("button",{type:"button",className:"ti-dropdown-item w-full ".concat(1===C&&"bg-primary/10 text-primary"),onClick:e=>et(e),children:"Tri par activit\xe9s"}),(0,r.jsx)("button",{type:"button",className:"ti-dropdown-item w-full ".concat(2===C&&"bg-primary/10 text-primary"),onClick:e=>et(e),children:"Tri par enfants"}),(0,r.jsx)("button",{type:"button",className:"ti-dropdown-item w-full ".concat(3===C&&"bg-primary/10 text-primary"),onClick:e=>et(e),children:"Tri par mois"})]})]})]})}),(0,r.jsxs)("div",{className:"box-body relative p-0",children:[(0,r.jsx)("input",{className:"sticky w-full !border-t-0 !border-r-0 !border-l-0 focus:border-gray-200",type:"text",placeholder:"Rechercher...",ref:X,onChange:e=>{let l=e.target.value,t=(0,c.eV)(l);z.current&&z.current.querySelectorAll("li").forEach(e=>{let l=(0,c.eV)(e.textContent||"");e.style.display=l.includes(t)?"block":"none"})}}),en&&(0,r.jsx)(o._N,{}),!en&&(0,r.jsxs)("ul",{className:"w-full flex flex-col overflow-y-scroll h-[500px] p-6",ref:z,children:[3===C&&x.i.map((e,l)=>(0,r.jsx)(i.Fragment,{children:(0,r.jsx)("li",{onClick:()=>er(l),className:"ti-list-group gap-x-3.5 bg-white text-gray-800 dark:bg-bgdark \n                                dark:border-white/10 dark:text-white \n                                ".concat(j===l?"!bg-primary text-white":"cursor-pointer"),children:"".concat(e," ").concat(new Date().getFullYear().toString())})},l)),2===C&&ed.map(e=>(0,r.jsx)(i.Fragment,{children:(0,r.jsxs)("li",{onClick:()=>ei(e.ELEVE_ID),className:"ti-list-group gap-x-3.5 bg-white text-gray-800 dark:bg-bgdark \n                                dark:border-white/10 dark:text-white \n                                ".concat(k===e.ELEVE_ID?"!bg-primary text-white":"cursor-pointer"),children:[e.NOM," ",e.PRENOM]})},e.ELEVE_ID)),1===C&&ec.map((e,l)=>(0,r.jsx)(i.Fragment,{children:(0,r.jsx)("li",{onClick:()=>ea(e.FRAIS_ID),className:"ti-list-group gap-x-3.5 bg-white text-gray-800 dark:bg-bgdark \n                                dark:border-white/10 dark:text-white\n                                ".concat(f===e.FRAIS_ID?"!bg-primary text-white":"cursor-pointer"),children:e.LIBELLE},e.FRAIS_ID)},l))]})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-1 w-3/4",children:(0,r.jsxs)("div",{className:"box h-[622px]",children:[(0,r.jsxs)("div",{className:"box-header flex justify-between items-center",children:[(0,r.jsx)("h5",{className:"box-title w-full",children:"Historique"}),3!==C&&(0,r.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{let e=new Date(M);e.setMonth(e.getMonth()-1),el(e)},children:(0,r.jsx)("i",{className:"ri-arrow-left-circle-line text-3xl"})}),(0,r.jsx)(u(),{showMonthYearPicker:!0,locale:"fr",dateFormat:"MMMM yyyy",className:"text-center w-full capitalize",selected:M,onChange:e=>el(e)}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e=new Date(M);e.setMonth(e.getMonth()+1),el(e)},children:(0,r.jsx)("i",{className:"ri-arrow-right-circle-line text-3xl"})})]}),(0,r.jsx)("div",{className:"w-full"})]}),(0,r.jsxs)("div",{className:"box-body flex flex-col overflow-auto",children:[I&&(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(o._N,{})}),!I&&(f||k||"number"==typeof j)&&G()>0&&(0,r.jsx)("div",{className:"flex items-center gap-2 w-full mb-3",children:(0,r.jsxs)("button",{type:"button",onClick:()=>ee(O.length===G()?0:G()),className:"flex items-center gap-2 rounded-md shadow-sm border border-gray-200 px-4 py-2",children:[O.length===G()?"Tout replier":"Tout d\xe9plier",(0,r.jsx)("i",{className:"".concat(O.length===G()?"ri-arrow-up-s-line":"ri-arrow-down-s-line"," text-2xl")})]})}),1===C&&!I&&f&&T&&0===T.length&&(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("h3",{className:"text-base font-semibold border bg-primary/10 text-primary border-gray-200 px-4 py-2 w-full",children:"Aucun historique pour ce mois"})})}),1===C&&!I&&f&&T.length>0&&Y&&Y.sort((e,l)=>{let t=em[e],r=em[l],i="".concat((null==t?void 0:t.NOM)||""," ").concat((null==t?void 0:t.PRENOM)||"").toLowerCase(),a="".concat((null==r?void 0:r.NOM)||""," ").concat((null==r?void 0:r.PRENOM)||"").toLowerCase();return i.localeCompare(a)}).map((e,l)=>{var t,a;return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)("div",{className:"text-base border bg-primary/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 w-1/3",children:[(0,r.jsxs)("h3",{className:"text-primary font-semibold cursor-pointer",onClick:()=>$(l),children:[null===(t=em[e])||void 0===t?void 0:t.NOM," ",null===(a=em[e])||void 0===a?void 0:a.PRENOM]}),(0,r.jsx)("i",{className:"ri-arrow-right-s-line cursor-pointer","aria-controls":"collapse".concat(l),onClick:()=>$(l)})]})}),O.includes(l)&&(0,r.jsx)("div",{className:"flex flex-col",children:T.filter(l=>l.ELEVE_ID===e).map((e,l)=>(0,r.jsx)("div",{className:"border border-gray-200 px-4 py-2 flex justify-between items-center",children:(0,r.jsxs)("p",{children:["A particip\xe9 le : ",(0,c.Ys)(e.DATE_FRAIS)]})},"".concat(e.ELEVE_ID,"-").concat(l)))})]},l)}),2===C&&!I&&k&&T&&0===T.length&&(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("h3",{className:"text-base font-semibold border bg-primary/10 text-primary border-gray-200 px-4 py-2 w-full",children:"Aucune historique pour ce enfant"})})}),2===C&&!I&&k&&T&&T.length>0&&H&&H.map((e,l)=>(0,r.jsx)(i.Fragment,{children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("div",{className:"text-base border bg-primary/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 w-1/3",children:[(0,r.jsx)("h3",{className:"text-primary font-semibold cursor-pointer",onClick:()=>$(l),children:e.LIBELLE}),(0,r.jsx)("i",{className:"ri-arrow-right-s-line cursor-pointer","aria-controls":"collapse".concat(l),onClick:()=>$(l)})]})}),O.includes(l)&&(0,r.jsx)("div",{className:"flex flex-col",children:T.filter(l=>l.LIBELLE===e.LIBELLE).map((e,l)=>(0,r.jsx)("div",{className:"border border-gray-200 px-4 py-2 flex justify-between items-center",children:(0,r.jsxs)("p",{children:["A particip\xe9 le : ",(0,c.Ys)(e.DATE_FRAIS)]})},"".concat(e.ELEVE_ID,"-").concat(e.DATE_FRAIS,"-").concat(l)))})]})})},l)),3===C&&!I&&"number"==typeof j&&0===Object.keys(J).length&&0===T.length&&(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("h3",{className:"text-base font-semibold border bg-primary/10 text-primary border-gray-200 px-4 py-2 w-full",children:"Aucune historique pour ce mois"})})}),3===C&&!I&&"number"==typeof j&&Object.keys(J).length>0&&Object.values(J).map((e,l)=>(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)("div",{className:"text-base border bg-primary/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 w-1/3",children:[(0,r.jsx)("h3",{className:"text-primary font-semibold cursor-pointer",onClick:()=>$(l),children:e.libelle}),(0,r.jsx)("i",{className:"ri-arrow-right-s-line cursor-pointer",onClick:()=>$(l)})]})}),O.includes(l)&&(0,r.jsx)("div",{className:"flex flex-col",children:Object.entries(e.eleves).sort((e,l)=>{let[t]=e,[r]=l,i=em[Number(t)],a=em[Number(r)],s="".concat((null==i?void 0:i.NOM)||""," ").concat((null==i?void 0:i.PRENOM)||"").toLowerCase(),n="".concat((null==a?void 0:a.NOM)||""," ").concat((null==a?void 0:a.PRENOM)||"").toLowerCase();return s.localeCompare(n)}).map(e=>{var l,t;let[i,a]=e;return(0,r.jsxs)("div",{className:"border border-gray-200 px-4 py-2",children:[(0,r.jsxs)("p",{className:"font-semibold",children:[null===(l=em[Number(i)])||void 0===l?void 0:l.NOM," ",null===(t=em[Number(i)])||void 0===t?void 0:t.PRENOM]}),(0,r.jsx)("ul",{className:"ml-4 list-disc",children:a.dates.map((e,l)=>(0,r.jsx)("li",{children:(0,c.Ys)(e)},l))})]},i)})})]},l))]})]})})]})]})};p.layout="Contentlayout";let v=p},66503:(e,l,t)=>{"use strict";t.d(l,{X:()=>s,i:()=>n});var r=t(11011),i=t(50810),a=t(84477);i.registerLocale(a);let s=r.i4.map(e=>{let l=(0,r.Ot)(e);return l.name=i.getName(l.iso2,"fr")||l.name,(0,r.vg)(l)}),n=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"]}},e=>{var l=l=>e(e.s=l);e.O(0,[374,833,718,150,552,328,923,636,593,792],()=>l(97474)),_N_E=e.O()}]);