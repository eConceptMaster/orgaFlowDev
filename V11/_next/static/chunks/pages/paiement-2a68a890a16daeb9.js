(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{91238:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/paiement",function(){return t(86697)}])},86697:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>m});var l=t(74848),s=t(96540),i=t(18382),a=t(6861),r=t(18322),o=t(18940),c=t(40350),E=t(93107);let d=()=>{var e,n,t,d;let m=(0,s.useRef)(null),u=(0,s.useRef)(null),[N,b]=(0,s.useState)(null),[A,T]=(0,s.useState)(""),[x,I]=(0,s.useState)(),[_,p]=(0,s.useState)([]),[g,z]=(0,s.useState)(!0),[h,v]=(0,s.useState)(!1),[f,j]=(0,s.useState)({EXTRAIT_ID:0,FLG_REMBOURSEMENT:0,MODULE_TYPE_TRANSFERT:0,PARENT_PAIEMENT_ID:0,REMARQUE:"Paiement r\xe9alis\xe9 via le site internet",TRANSFERT_LIER_ID:0,DATE_PAIEMENT:new Date().toISOString(),ANNEE_SCOLAIRE:0,ELEVE_ID:0,FRAIS_ID:0,TYPE_PAIEMENT:0}),[R,L]=(0,s.useState)({}),S=(0,s.useRef)(null),O=async(e,n)=>{var t,l,s,i,a;b(e),T(n);let{result:o}=await (0,r.Fd)("/facturation/Activite/TotalByEleves",!1,{ListeEleve:[e]}),c=null!==(t=null==o?void 0:o.data)&&void 0!==t?t:null,E=null!==(l=null==o?void 0:o.error)&&void 0!==l?l:null;if(E){alert(JSON.stringify(null===(s=E.response)||void 0===s?void 0:s.data));return}I(c[0]);let{result:d}=await (0,r.Fd)("/fraispaiement/eleve/".concat(e)),m=null!==(i=null==d?void 0:d.data)&&void 0!==i?i:null,u=null!==(a=null==d?void 0:d.error)&&void 0!==a?a:null;if(u){alert(JSON.stringify(u));return}p(null!=m?m:[]),z(!1)},D=async e=>{let n=o.Yo.safeParse(e);if(!n.success){let e=n.error.flatten().fieldErrors;console.log(e);let t=Object.keys(e).reduce((e,n)=>(e[n]=!0,e),{});return L(e=>({...e,...t})),!1}return!0},C=()=>{if(h){let e=document.querySelector("#addPayment");setTimeout(()=>window.HSOverlay.open(e),50),v(!1)}},M=()=>{let e=document.querySelector("#addPayment");window.HSOverlay.close(e)},y=async e=>{var n,t;e.preventDefault();let l=Number(localStorage.getItem("annee")),s={...f,ANNEE_SCOLAIRE:l,ELEVE_ID:N};D(s)||console.error(R);let{error:i}=await (0,r.sS)("/fraispaiement",!1,s);if(i){alert(JSON.stringify(null===(t=i.response)||void 0===t?void 0:t.data));return}p(e=>[s,...e]),j({EXTRAIT_ID:0,FLG_REMBOURSEMENT:0,MODULE_TYPE_TRANSFERT:0,PARENT_PAIEMENT_ID:0,REMARQUE:"Paiement r\xe9alis\xe9 via le site internet",TRANSFERT_LIER_ID:0,DATE_PAIEMENT:new Date().toISOString(),ANNEE_SCOLAIRE:0,ELEVE_ID:0,FRAIS_ID:0,TYPE_PAIEMENT:0}),null===(n=S.current)||void 0===n||n.reset(),I(e=>e?{COUT_TOTAL:e.COUT_TOTAL,MONTANT_PAYE:e.MONTANT_PAYE+s.MONTANT,BALANCE:e.BALANCE-s.MONTANT}:e),M()},{result:P,loading:w}=(0,a.s)("/eleves"),F=null==P?void 0:P.data,U=null==P?void 0:P.error;if(U){alert(JSON.stringify(null===(e=U.response)||void 0===e?void 0:e.data));return}return(0,s.useEffect)(()=>{C()},[h]),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{title:"Liste des paiements"}),(0,l.jsx)(E.A,{currentpage:"Liste des paiements",activepage:"Liste des paiements",mainpage:""}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsx)("div",{className:"box w-1/4",children:(0,l.jsxs)("div",{className:"box-body relative p-0",children:[(0,l.jsx)("input",{className:"sticky w-full !border-t-0 !border-r-0 !border-l-0 focus:border-gray-200",type:"text",placeholder:"Rechercher...",ref:m,onChange:e=>{let n=e.target.value,t=(0,r.eV)(n);u.current&&u.current.querySelectorAll("li").forEach(e=>{let n=(0,r.eV)(e.textContent||"");e.style.display=n.includes(t)?"block":"none"})}}),w&&(0,l.jsx)(i._N,{}),!w&&(0,l.jsx)("ul",{className:"w-full flex flex-col overflow-y-scroll h-[600px] pt-6 px-6",ref:u,children:F&&F.map(e=>(0,l.jsx)(s.Fragment,{children:(0,l.jsxs)("li",{className:"ti-list-group gap-x-3.5 bg-white text-gray-800 dark:bg-bgdark \n                                dark:border-white/10 dark:text-white \n                                ".concat(N===e.ELEVE_ID?"!bg-primary text-white":"cursor-pointer"),onClick:()=>{var n;return O(e.ELEVE_ID,"".concat(e.NOM," ").concat(null!==(n=e.PRENOM)&&void 0!==n?n:""))},children:[e.NOM," ",e.PRENOM]})},e.ELEVE_ID))})]})}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 w-3/4",children:[(0,l.jsx)("div",{className:"h-[180px] flex gap-6",children:(0,l.jsxs)("div",{className:"box",children:[(0,l.jsx)("div",{className:"box-header",children:(0,l.jsxs)("div",{className:"flex items-center w-full",children:[(0,l.jsx)("i",{className:"ri-bank-line text-3xl absolute"}),(0,l.jsx)("div",{className:"text-base font-semibold pl-12",children:(0,l.jsxs)("p",{children:["Balance des comptes"," ",N&&"de ".concat(A)]})})]})}),(0,l.jsxs)("div",{className:"box-body py-6 px-2 ",children:[N&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("span",{className:"badge bg-danger/10 text-danger",children:"Montant \xe0 percevoir"}),(0,l.jsxs)("span",{className:"badge bg-danger/10 text-danger",children:[null!==(n=null==x?void 0:x.BALANCE)&&void 0!==n?n:0," "," €"]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("span",{className:"badge bg-success/10 text-success",children:"Montant per\xe7u"}),(0,l.jsxs)("span",{className:"badge bg-success/10 text-success",children:[null!==(t=null==x?void 0:x.MONTANT_PAYE)&&void 0!==t?t:0," "," €"]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("span",{className:"badge bg-warning/10 text-warning",children:"Montant total"}),(0,l.jsxs)("span",{className:"badge bg-warning/10 text-warning",children:[null!==(d=null==x?void 0:x.COUT_TOTAL)&&void 0!==d?d:0," "," €"]})]})]}),!N&&(0,l.jsx)("div",{className:"flex justify-center items-center",children:(0,l.jsx)("span",{className:"badge bg-gray-500/20",children:"S\xe9lectionnez un enfant"})})]})]})}),(0,l.jsxs)("div",{className:"box h-[calc(100vh-485px)]",children:[(0,l.jsxs)("div",{className:"box-header flex justify-between items-center",children:[(0,l.jsx)("h5",{className:"box-title w-full",children:"Paiements"}),(0,l.jsxs)("div",{className:"w-full flex justify-end",children:[N&&(0,l.jsxs)("button",{type:"button",className:"ti-btn ti-btn-outline ti-btn-outline-info rounded-full",onClick:()=>v(!0),children:[(0,l.jsx)("i",{className:"ri-add-line"}),"Ajouter un paiement"]}),(0,l.jsx)("div",{id:"addPayment",className:"hidden ti-modal",children:(0,l.jsx)("div",{className:"hs-overlay-open:mt-7 ti-modal-box mt-0 ease-out min-h-[calc(100%-3.5rem)] flex items-center",children:(0,l.jsxs)("div",{className:"ti-modal-content",children:[(0,l.jsxs)("div",{className:"ti-modal-header",children:[(0,l.jsx)("h3",{className:"ti-modal-title",children:"Ajouter un paiement"}),(0,l.jsxs)("button",{type:"button",className:"ti-modal-clode-btn",onClick:M,children:[(0,l.jsx)("span",{className:"sr-only",children:"Close"}),(0,l.jsx)("svg",{className:"w-3.5 h-3.5",width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M0.258206 1.00652C0.351976 0.912791 0.479126 0.860131 0.611706 0.860131C0.744296 0.860131 0.871447 0.912791 0.965207 1.00652L3.61171 3.65302L6.25822 1.00652C6.30432 0.958771 6.35952 0.920671 6.42052 0.894471C6.48152 0.868271 6.54712 0.854471 6.61352 0.853901C6.67992 0.853321 6.74572 0.865971 6.80722 0.891111C6.86862 0.916251 6.92442 0.953381 6.97142 1.00032C7.01832 1.04727 7.05552 1.1031 7.08062 1.16454C7.10572 1.22599 7.11842 1.29183 7.11782 1.35822C7.11722 1.42461 7.10342 1.49022 7.07722 1.55122C7.05102 1.61222 7.01292 1.6674 6.96522 1.71352L4.31871 4.36002L6.96522 7.00648C7.05632 7.10078 7.10672 7.22708 7.10552 7.35818C7.10442 7.48928 7.05182 7.61468 6.95912 7.70738C6.86642 7.80018 6.74102 7.85268 6.60992 7.85388C6.47882 7.85498 6.35252 7.80458 6.25822 7.71348L3.61171 5.06702L0.965207 7.71348C0.870907 7.80458 0.744606 7.85498 0.613506 7.85388C0.482406 7.85268 0.357007 7.80018 0.264297 7.70738C0.171597 7.61468 0.119017 7.48928 0.117877 7.35818C0.116737 7.22708 0.167126 7.10078 0.258206 7.00648L2.90471 4.36002L0.258206 1.71352C0.164476 1.61976 0.111816 1.4926 0.111816 1.36002C0.111816 1.22744 0.164476 1.10028 0.258206 1.00652Z",fill:"currentColor"})})]})]}),(0,l.jsx)("div",{className:"ti-modal-body",children:(0,l.jsx)("form",{className:"ti-validation",ref:S,onKeyUp:e=>{"Enter"===e.key&&y(e)},children:(0,l.jsxs)("div",{className:"space-y-2 relative",children:[(0,l.jsx)("label",{className:"ti-form-label mb-0",children:"Montant"}),(0,l.jsx)("input",{type:"number",className:R.MONTANT?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"MONTANT",value:f.MONTANT,onChange:e=>{let{name:n,value:t}=e.target;L(e=>({...e,[n]:!1})),j(e=>({...e,[n]:Number(t)}))}}),(0,a.B)(R.MONTANT)]})})}),(0,l.jsx)("div",{className:"ti-modal-footer",children:(0,l.jsx)("button",{type:"button",className:"ti-btn ti-btn-outline ti-btn-outline-success rounded-full",onClick:y,children:"Ajouter"})})]})})})]})]}),(0,l.jsxs)("div",{className:"box-body flex flex-col overflow-auto",children:[g&&N&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(i._N,{})}),!g&&N&&(null==_?void 0:_.length)>0&&(0,l.jsx)("div",{className:"flex justify-center gap-2 mb-6",children:(0,l.jsx)("span",{className:"badge bg-success/20 text-success h-[28px]",children:"Montant per\xe7u"})}),!g&&N&&(null==_?void 0:_.length)>0&&_.map(e=>{var n;return(0,l.jsx)(s.Fragment,{children:(0,l.jsxs)("div",{className:"text-base border bg-primary/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:[(0,l.jsx)("div",{className:"flex items-center gap-2 w-1/3",children:(0,l.jsx)("h3",{className:"text-primary font-semibold",children:(0,r.Ys)(e.DATE_PAIEMENT)})}),(0,l.jsx)("div",{className:"flex gap-16 w-1/3 justify-center",children:(0,l.jsxs)("span",{className:"badge bg-white text-success h-[28px]",children:[null!==(n=e.MONTANT)&&void 0!==n?n:0," "," €"]})}),(0,l.jsx)("div",{className:"w-1/3"})]})},e.FRAIS_PAIEMENT_ID)}),!g&&N&&(null==_?void 0:_.length)===0&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("div",{className:"text-base border bg-primary/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:(0,l.jsx)("div",{className:"flex items-center gap-2 w-1/3",children:(0,l.jsx)("h3",{className:"text-primary font-semibold",children:"Aucune paiement pour cet élève"})})})})})]})]})]})]})]})};d.layout="Contentlayout";let m=d},18940:(e,n,t)=>{"use strict";t.d(n,{EY:()=>c,JO:()=>E,LB:()=>i,Sg:()=>o,UG:()=>r,Yo:()=>u,iR:()=>a});var l=t(18322),s=t(14476);let i=s.z.object({MAIL:s.z.string().min(1),TEL:s.z.string().optional(),PASSWORD:s.z.string()}),a=s.z.object({MAIL:s.z.string().email().optional(),TELEPHONE:s.z.number().refine(e=>{let n=e.toString();return!(n.length<3)&&(0,l.Q7)("+".concat(n))},{message:"Le num\xe9ro doit contenir au moins 3 chiffres et \xeatre valide avec l'indicatif du pays.,"}),PASSWORD:s.z.string().min(1),TYPE_USER:s.z.number().min(1),FLAG_MAIL_VERIFIED:s.z.number().optional(),FLAG_TELEPHONE_VERIFIED:s.z.number().optional(),DATETIME_CREATION:s.z.string().datetime().min(1),CODE_PIN:s.z.number().optional()}),r=s.z.object({ID:s.z.number().optional(),NOM:s.z.string().min(1),PRENOM:s.z.string().optional(),REGISTRE_NATIONAL:s.z.string().optional(),TYPE_CIVILITE:s.z.number().refine(e=>e>=0&&e<=2,{message:"Vous devez choisir un genre"}),NUMERO_RESPONSABLE:s.z.number(),UID:s.z.string().min(1),TELEPHONE:s.z.number().refine(e=>{let n=e.toString();return(0,l.Q7)("+".concat(n))},{message:"Le num\xe9ro doit \xeatre valide avec le format du pays."}),MAIL:s.z.string().email().optional()});s.z.object({username:s.z.string().min(1),password:s.z.string().min(1)});let o=s.z.object({NOM:s.z.string().min(1),ELEVE_ID:s.z.number().optional(),PRENOM:s.z.string().optional(),SEXE_TYPE:s.z.string().min(1),LIEU_NAISSANCE:s.z.string().min(1),CODE_PAYS_NAIS:s.z.string().optional(),NAISSANCE_DATE:s.z.string().datetime({local:!0}).min(1),CODE_NATIONALITE:s.z.string().optional(),NISS:s.z.string().optional(),TELEPHONE:s.z.string().optional().refine(e=>!e||e.length<3||(0,l.Q7)("+".concat(e)),{message:"le num\xe9ro doit contenir au moins 3 chiffres et быть valide avec l'indicatif du pays."})}),c=s.z.object({ADRESSE_ID:s.z.number().optional(),ELEVE_ID:s.z.number().optional(),RESPONSABLE_ID:s.z.number().optional(),ADRESSE:s.z.string().min(1),NUMERO:s.z.string().min(1),CODE_POSTAL:s.z.number().min(4).nullable(),LOCALITE:s.z.string().min(1),NUM_BOITE:s.z.string().optional(),CODE_POSTAL2:s.z.string().optional()}),E=s.z.object({LIBELLE:s.z.string().min(1),MONTANT:s.z.number().min(1).nullable(),ANNEE_SCOLAIRE:s.z.number().min(1),TYPE_FRAIS:s.z.number().min(0),DATE_FRAIS:s.z.string().optional(),DATE_ECHEANCE:s.z.string().datetime().optional(),DATE_FRAIS_FIN:s.z.string().datetime().optional(),FRAIS_ID:s.z.number().optional(),CATEGORIE_ID:s.z.number()});s.z.object({FRAIS_INSCRIPTION_ID:s.z.number().optional(),ELEVE_ID:s.z.number(),FRAIS_ID:s.z.number(),DATE_INSCRIPTION:s.z.string().datetime({local:!0}),DATE_DEPART:s.z.string().datetime({local:!0}).optional()}),s.z.object({FRAIS_ITEM_ID:s.z.number().optional(),FRAIS_PARENT_ID:s.z.number().optional(),LIBELLE:s.z.string().optional(),PRIX:s.z.number().optional()}),s.z.object({FRAIS_ITEM_ELEVE_ID:s.z.number().optional(),FRAIS_ITEM_ID:s.z.number().optional(),ELEVE_ID:s.z.number().optional(),QTE:s.z.number().optional(),COUT_UNIT:s.z.number(),COUT_TOTAL:s.z.number().optional(),DATE_FRAIS:s.z.string().datetime({local:!0}),DATE_MODIF:s.z.string().optional(),USER_ENCODE:s.z.string().optional(),USER_ID:s.z.number().optional(),PROF_ID:s.z.string().optional()});let d=s.z.object({ELEVE_ID:s.z.number().optional(),FRAIS_ID:s.z.number(),LIBELLE:s.z.string(),COUT_TOTAL:s.z.number(),COMMUNICATION_STRUCTUREE:s.z.string().optional()}),m=s.z.object({ELEVE_ID:s.z.number(),FRAIS_ITEM:s.z.array(d)});s.z.array(m),s.z.object({COUT_TOTAL:s.z.number(),MONTANT_PAYE:s.z.number(),BALANCE:s.z.number()}),s.z.object({ELEVE_ID:s.z.number(),COUT_TOTAL:s.z.number(),MONTANT_PAYE:s.z.number(),BALANCE:s.z.number()}),s.z.object({ELEVE_ID:s.z.number(),FRAIS_ID:s.z.number(),LIBELLE:s.z.string(),DATE_FRAIS:s.z.string().datetime({local:!0})}),s.z.object({ID:s.z.number(),REFERENCE:s.z.string(),ID_REFERENCE:s.z.string(),LIBELLE_REFERENCE:s.z.string()});let u=s.z.object({FRAIS_PAIEMENT_ID:s.z.number().optional(),ELEVE_ID:s.z.number(),MONTANT:s.z.number().optional(),TYPE_PAIEMENT:s.z.number(),DATE_PAIEMENT:s.z.string().datetime({local:!0}),FRAIS_ID:s.z.number(),REMARQUE:s.z.string(),FLG_REMBOURSEMENT:s.z.number(),EXTRAIT_ID:s.z.number(),ANNEE_SCOLAIRE:s.z.number(),PARENT_PAIEMENT_ID:s.z.number(),TRANSFERT_LIER_ID:s.z.number(),MODULE_TYPE_TRANSFERT:s.z.number()})}},e=>{var n=n=>e(e.s=n);e.O(0,[374,718,476,923,636,593,792],()=>n(91238)),_N_E=e.O()}]);