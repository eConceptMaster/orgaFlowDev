(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[254],{95596:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/facturation",function(){return t(53226)}])},53226:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>u});var s=t(74848),a=t(96540),i=t(40350),r=t(93107),n=t(6861),c=t(18382),d=t(18322);t(77571);let o=()=>{var e,l,t,o,u;let[x,f]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[g,N]=(0,a.useState)("Tri par activit\xe9s"),[m,j]=(0,a.useState)(!1),[y,w]=(0,a.useState)(!1),[E,A]=(0,a.useState)(!1),[_,L]=(0,a.useState)([]),[S,C]=(0,a.useState)(null),[O,k]=(0,a.useState)(null),T=(0,a.useRef)(null),F=(0,a.useRef)(null),B=async e=>{var l,t,s,a,i,r;w(e=>!e);let{result:n,loading:c}=await (0,d.Fd)("/facturation/activite/totalbyfrais",!1),{result:o,loading:u}=await (0,d.Fd)("/facturation/activite/totalbyEleves",!1,{ListeEleve:[e]}),x=null!==(l=null==n?void 0:n.data)&&void 0!==l?l:null,f=null!==(t=null==n?void 0:n.error)&&void 0!==t?t:null,v=null!==(s=null==o?void 0:o.data)&&void 0!==s?s:null,b=null!==(a=null==o?void 0:o.error)&&void 0!==a?a:null;if(f){alert(JSON.stringify(null===(i=f.response)||void 0===i?void 0:i.data));return}if(b){alert(JSON.stringify(null===(r=b.response)||void 0===r?void 0:r.data));return}v&&v[0]&&v[0].BALANCE<=0?j(!1):j(!0),C(x),k(v[0]),c||u||w(e=>!e)},I=async()=>{var e,l,t;let{result:s}=await (0,d.Fd)("/facturation/activite/eleves",!1,{ListeEleve:[h]}),a=null!==(e=null==s?void 0:s.data)&&void 0!==e?e:null,i=null!==(l=null==s?void 0:s.error)&&void 0!==l?l:null;if(i){alert(JSON.stringify(null===(t=i.response)||void 0===t?void 0:t.data));return}A(!0),L(a[0]?a[0].FRAIS_ITEM:[])},R=async()=>{if(h){var e,l;let{result:t}=await (0,d.Fd)("/facturation/activite/pdf",!1,{ListeEleve:[h]},"blob"),s=null!==(e=null==t?void 0:t.data)&&void 0!==e?e:null,a=null!==(l=null==t?void 0:t.error)&&void 0!==l?l:null;if(a){if(422!==a.status){alert(JSON.stringify(a.message));return}if(422===a.status){j(e=>!e),setTimeout(()=>j(e=>!e),3e3);return}}else{console.log(s);let e=new Blob([s],{type:"application/pdf"}),l=URL.createObjectURL(e);window.open(l)}}},M=async e=>{p(e),A(!1),L([]),B(e)};(0,a.useEffect)(()=>{let e=localStorage.getItem("annee");console.log(e),e&&b({AnneeScolaire:Number(e)})},[]);let{result:J,loading:V}=(0,n.s)("/eleves"),P=null!==(e=null==J?void 0:J.data)&&void 0!==e?e:[],U=null!==(l=null==J?void 0:J.error)&&void 0!==l?l:null;return U&&alert(JSON.stringify(U)),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.A,{title:"Facturation"}),(0,s.jsx)(r.A,{currentpage:"Facturation",activepage:"Facturation",mainpage:""}),(0,s.jsxs)("div",{className:"flex gap-6",children:[(0,s.jsx)("div",{className:"box w-1/4",children:(0,s.jsxs)("div",{className:"box-body relative p-0",children:[(0,s.jsx)("input",{className:"sticky w-full !border-t-0 !border-r-0 !border-l-0 focus:border-gray-200",type:"text",placeholder:"Rechercher...",ref:F,onChange:e=>{let l=e.target.value,t=(0,d.eV)(l);T.current&&T.current.querySelectorAll("li").forEach(e=>{let l=(0,d.eV)(e.textContent||"");e.style.display=l.includes(t)?"block":"none"})}}),V&&(0,s.jsx)(c._N,{}),!V&&(0,s.jsx)("ul",{className:"w-full flex flex-col overflow-y-scroll h-[600px] p-6",ref:T,children:P.map(e=>(0,s.jsx)(a.Fragment,{children:(0,s.jsxs)("li",{onClick:()=>M(e.ELEVE_ID),className:"ti-list-group gap-x-3.5 bg-white text-gray-800 dark:bg-bgdark \n                                dark:border-white/10 dark:text-white \n                                ".concat(h===e.ELEVE_ID?"!bg-primary text-white":"cursor-pointer"),children:[e.NOM," ",e.PRENOM]})},e.ELEVE_ID))})]})}),(0,s.jsx)("div",{className:"flex flex-col gap-1 w-3/4",children:(0,s.jsxs)("div",{className:"box h-[650px]",children:[(0,s.jsxs)("div",{className:"box-header flex justify-between items-center",children:[(0,s.jsx)("h5",{className:"box-title w-full",children:"Facturation"}),(0,s.jsx)("div",{className:"w-full flex justify-end",children:(0,s.jsx)("button",{type:"button",className:m?"":"text-gray-400 cursor-default",onClick:R,disabled:!m,children:(0,s.jsx)("i",{className:"ri-printer-line text-3xl"})})})]}),(0,s.jsxs)("div",{className:"box-body flex flex-col overflow-auto",children:[y&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(c._N,{})}),!y&&h&&O&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("button",{type:"button",className:"text-base border bg-info/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",onClick:()=>{E?A(!1):I()},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"text-info font-semibold",children:"Montant total"}),(0,s.jsx)("i",{className:"".concat(E?"ri-arrow-down-s-line":"ri-arrow-right-s-line")})]}),(0,s.jsx)("div",{className:"flex gap-16 justify-center",children:(0,s.jsxs)("span",{className:"badge bg-white text-info h-[28px]",children:[null!==(t=O.COUT_TOTAL)&&void 0!==t?t:0," €"]})})]}),0===_.length&&E&&(0,s.jsx)("div",{className:"text-base border border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:"Aucun frais"}),_.length>0&&E&&_.map((e,l)=>{var t;return(0,s.jsx)(a.Fragment,{children:(0,s.jsxs)("div",{className:"text-base border border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:[(0,s.jsx)("span",{children:e.LIBELLE}),(0,s.jsxs)("span",{className:"badge bg-white text-info h-[28px]",children:[null!==(t=e.COUT_TOTAL)&&void 0!==t?t:0," €"]})]})},l)}),(0,s.jsxs)("div",{className:"text-base border bg-info/10 border-gray-200 px-4 py-2 w-full flex justify-between items-center",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("h3",{className:"text-info font-semibold",children:"Montant per\xe7u"})}),(0,s.jsx)("div",{className:"flex gap-16 justify-center",children:(0,s.jsxs)("span",{className:"badge bg-white text-info h-[28px]",children:[null!==(o=O.MONTANT_PAYE)&&void 0!==o?o:0," €"]})})]}),(0,s.jsxs)("div",{className:"text-base border ".concat(O.BALANCE<0?"bg-danger/10":"bg-success/10"," border-gray-200 px-4 py-2 w-full flex justify-between items-center"),children:[(0,s.jsx)("div",{className:"flex items-center gap-2 ",children:(0,s.jsx)("h3",{className:"font-semibold ".concat(O.BALANCE<0?"text-danger":"text-success"),children:"BALANCE"})}),(0,s.jsx)("div",{className:"flex gap-16 justify-center",children:(0,s.jsxs)("span",{className:"badge bg-white h-[28px] ".concat(O.BALANCE<0?"text-danger":"text-success"),children:[null!==(u=O.BALANCE)&&void 0!==u?u:0," €"]})})]})]})})]})]})})]})]})};o.layout="Contentlayout";let u=o},77571:()=>{}},e=>{var l=l=>e(e.s=l);e.O(0,[374,718,150,923,636,593,792],()=>l(95596)),_N_E=e.O()}]);