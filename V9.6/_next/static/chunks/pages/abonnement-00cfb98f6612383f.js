(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[449],{86470:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/abonnement",function(){return a(27213)}])},27213:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(74848),n=a(96540),i=a(40350),r=a(93107),l=a(96967);a(13084);var o=a(18382),d=a(18322);class c extends n.Component{componentDidMount(){let e=localStorage.getItem("annee");e&&this.fetchData(e)}render(){let{data:e}=this.state;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"box-body space-y-3",children:(0,s.jsx)("div",{className:"overflow-hidden table-bordered",children:(0,s.jsxs)("div",{children:[this.isLoading&&(0,s.jsx)(o.Qv,{numberOfColumns:this.columns.length}),!this.isLoading&&(0,s.jsx)(l.ReactTabulator,{columns:this.columns,options:{pagination:"local",paginationSize:10,paginationSizeSelector:[10,20,50,100],paginationInitialPage:1,paginationButtonCount:5,paginationDataReceived:{last_page:1},paginationDataSent:{page:1,size:10}},events:{rowClick:this.rowClick},onRef:e=>{this.props.refTable(e)},data:e,"data-custom-attr":"test-custom-attribute",className:"ti-custom-table ti-striped-table ti-custom-table-hover"})]})})})})}constructor(e){super(e),this.isLoading=!0,this.handleNamePage=(e,t,a)=>{let{namePage:s,isActif:n,mainPage:i,infoChecking:r,idCost:l}=this.props;r(!0),s(e),n(!0),i(t),l(a)},this.columns=[{title:"Libelle",field:"LIBELLE"},{title:"Montant",field:"MONTANT"},{title:"Ann\xe9e",field:"ANNEE_SCOLAIRE"}],this.fetchData=async e=>{var t,a;let{result:s,loading:n}=await (0,d.Fd)("/frais/typefrais/0",!1,{anneescolaire:e}),i=null!==(t=null==s?void 0:s.data)&&void 0!==t?t:null,r=null!==(a=null==s?void 0:s.error)&&void 0!==a?a:null;r&&console.error(r);let l=(null!=i?i:[]).map(e=>({FRAIS_ID:e.FRAIS_ID,LIBELLE:e.LIBELLE,MONTANT:"".concat(String(e.MONTANT.toFixed(2)).replace(".",",")," â‚¬"),ANNEE_SCOLAIRE:e.ANNEE_SCOLAIRE,DATE_FRAIS:e.DATE_FRAIS}));this.setState({data:l}),this.props.dataTable(l),this.isLoading=n,setTimeout(()=>{let e=document.querySelector(".tabulator-page[title='First Page']"),t=document.querySelector(".tabulator-page[title='Prev Page']"),a=document.querySelector(".tabulator-page[title='Next Page']"),s=document.querySelector(".tabulator-page[title='Last Page']");e&&(e.textContent="Premi\xe8re"),t&&(t.textContent="Pr\xe9c\xe9dente"),a&&(a.textContent="Suivante"),s&&(s.textContent="Derni\xe8re")},10)},this.rowClick=(e,t)=>{this.handleNamePage("Info Abonnement","Info Abonnement",String(t.getData().FRAIS_ID))},this.clearData=()=>{this.setState({data:[]})},this.state={data:[]}}}var u=a(59386),m=a.n(u);a(77571);var h=a(20757),b=a(18940),g=a(6861);let N=e=>{let{namePage:t,isActif:a,mainPage:i,isChecking:r,setInfoChecking:l,idCost:c,setIdCost:u}=e,[N,E]=(0,n.useState)({}),[x,p]=(0,n.useState)(""),[A,f]=(0,n.useState)(null),[C,v]=(0,n.useState)(null),[j,y]=(0,n.useState)(!0),[L,w]=(0,n.useState)(!1),[S,T]=(0,n.useState)({LIBELLE:"",MONTANT:0,ANNEE_SCOLAIRE:Number(localStorage.getItem("annee")),TYPE_FRAIS:0,DATE_ECHEANCE:""}),[I,_]=(0,n.useState)({LIBELLE:"",MONTANT:0,ANNEE_SCOLAIRE:Number(localStorage.getItem("annee")),TYPE_FRAIS:0,DATE_ECHEANCE:""}),k=()=>{let e=b.JO.safeParse(S);if(!e.success){let t=e.error.flatten().fieldErrors;console.log(t);let a=Object.keys(t).reduce((e,t)=>(e[t]=!0,e),{});return E(e=>({...e,...a})),!1}return!0},D=async()=>{if(!k())return;let{data:e,error:t}=await (0,d.sS)("/frais",!1,S);t&&console.error(t),e&&(T({LIBELLE:"",MONTANT:0,ANNEE_SCOLAIRE:0,TYPE_FRAIS:0,DATE_FRAIS:"",DATE_ECHEANCE:"",DATE_FRAIS_FIN:""}),f(null),w(e=>!e),setTimeout(()=>{w(e=>!e)},1e3))},O=(e,s)=>{l(!1),a(!1),t(e),i(s),u("")},R=e=>{T(t=>({...t,DATE_ECHEANCE:e?(0,d.wj)(e):""})),console.log((0,d.wj)(e)),f(new Date((0,d.wj)(e))),E(e=>({...e,DATE_ECHEANCE:!1}))},M=e=>{let{name:t,value:a}=e.target;"MONTANT"===t?T(e=>({...e,[t]:Number(a)})):T(e=>({...e,[t]:a})),E(e=>({...e,[t]:!1}))},F=async()=>{let e={...S,FRAIS_ID:c},{data:t,error:a}=await (0,d.FI)("/frais",!1,e);a&&console.error(a),t&&y(!1)},P=async()=>{let{data:e,error:t}=await (0,d.Wv)("/frais/".concat(c));t&&console.error(t),e&&setTimeout(()=>O("Abonnement",""),50)},B=e=>{T({LIBELLE:e.LIBELLE,MONTANT:e.MONTANT,ANNEE_SCOLAIRE:e.ANNEE_SCOLAIRE,TYPE_FRAIS:e.TYPE_FRAIS,DATE_FRAIS:e.DATE_FRAIS,DATE_ECHEANCE:e.DATE_ECHEANCE}),void 0!==e.DATE_ECHEANCE&&f(new Date(e.DATE_ECHEANCE))},{result:H,loading:z}=(0,g.s)("/frais/".concat(c));return(0,n.useEffect)(()=>{if(null==H?void 0:H.error){console.error(H.error);return}if(Array.isArray(null==H?void 0:H.data)){if(0===H.data.length){let e=localStorage.getItem("annee");e&&p(e)}}else(null==H?void 0:H.data)&&"object"==typeof H.data&&(B(H.data),y(!1))},[H]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"grid grid-cols-12 gap-6",children:(0,s.jsx)("div",{className:"col-span-12",children:(0,s.jsxs)("div",{className:"box",children:[(0,s.jsx)("div",{className:"box-header",children:(0,s.jsxs)("button",{type:"button",className:"ti-btn !rounded-full ti-btn-outline-info",onClick:()=>O("Abonnement",""),children:[(0,s.jsx)("i",{className:"ti ti-arrow-back font-bold"}),"Retour"]})}),L&&(0,s.jsxs)("div",{className:"flex flex-col items-center my-6",children:[(0,s.jsx)("h3",{className:"text-2xl font-semibold",children:"L'abonnement a bien \xe9t\xe9 cr\xe9\xe9 !"}),(0,s.jsx)("i",{className:"ri-checkbox-circle-line text-[100px] leading-none text-success relative",children:(0,s.jsx)("span",{className:"bg-success/10 rounded-full absolute w-4/5 h-[75px] bottom-[15%] left-[10%]"})})]}),z&&(0,s.jsx)(o.eI,{}),!z&&!L&&(0,s.jsxs)("div",{className:"box-body",children:[(0,s.jsxs)("form",{className:"ti-validation",children:[(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Libelle"}),(0,s.jsx)("input",{type:"text",className:N.LIBELLE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"LIBELLE",value:S.LIBELLE,readOnly:!j,onChange:M,autoFocus:!0}),(0,g.B)(N.LIBELLE)]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Montant"}),(0,s.jsx)("input",{type:"number",className:N.MONTANT?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"MONTANT",value:S.MONTANT,onChange:M,readOnly:!j}),(0,g.B)(N.MONTANT)]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Ann\xe9e de l'abonnement"}),(0,s.jsx)("input",{type:"number",className:"my-auto ti-form-input",name:"ANNEE_SCOLAIRE",value:S.ANNEE_SCOLAIRE||Number(x),onChange:M,disabled:!0})]}),(0,s.jsxs)("div",{className:"space-y-2 relative",children:[(0,s.jsx)("label",{className:"ti-form-label mb-0",children:"Date d'\xe9ch\xe9ance"}),(0,s.jsx)(m(),{className:N.DATE_ECHEANCE?"my-auto ti-form-input !border-red-600":"my-auto ti-form-input",name:"DATE_ECHEANCE",showIcon:!0,locale:h.A,dateFormat:"dd/MM/yyyy",selected:A,onChange:e=>R(e),disabled:!j}),(0,g.B)(N.DATE_ECHEANCE)]})]}),(0,s.jsxs)("div",{children:[!r&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-primary",onClick:D,children:"Cr\xe9er"}),r&&!j&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-warning",onClick:()=>{y(!0),_({...S}),v(A)},children:"Editer"}),r&&!j&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-danger","data-hs-overlay":"#deleteModal",children:"Supprimer"}),j&&r&&(0,s.jsx)("button",{type:"button",className:"mt-4 ti-btn ti-btn-success",onClick:F,children:"Valider"}),j&&r&&(0,s.jsx)("button",{type:"submit",className:"hs-dropdown-toggle ti-btn ti-border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:ring-offset-white focus:ring-primary dark:bg-bgdark dark:hover:bg-black/20 dark:border-white/10 dark:text-white/70 dark:hover:text-white dark:focus:ring-offset-white/10",onClick:()=>{y(!1),T({...I}),f(C)},children:"Annuler"})]})]}),(0,s.jsx)("div",{id:"deleteModal",className:"hs-overlay hidden ti-modal",children:(0,s.jsx)("div",{className:"hs-overlay-open:mt-7 ti-modal-box mt-0 ease-out",children:(0,s.jsxs)("div",{className:"ti-modal-content",children:[(0,s.jsxs)("div",{className:"ti-modal-header",children:[(0,s.jsx)("h3",{className:"ti-modal-title",children:"Suppression d'Abonnement"}),(0,s.jsxs)("button",{type:"button",className:"hs-dropdown-toggle ti-modal-close-btn","data-hs-overlay":"#deleteModal",children:[(0,s.jsx)("span",{className:"sr-only",children:"Fermer"}),(0,s.jsx)("svg",{className:"w-3.5 h-3.5",width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M0.258206 1.00652C0.351976 0.912791 0.479126 0.860131 0.611706 0.860131C0.744296 0.860131 0.871447 0.912791 0.965207 1.00652L3.61171 3.65302L6.25822 1.00652C6.30432 0.958771 6.35952 0.920671 6.42052 0.894471C6.48152 0.868271 6.54712 0.854471 6.61352 0.853901C6.67992 0.853321 6.74572 0.865971 6.80722 0.891111C6.86862 0.916251 6.92442 0.953381 6.97142 1.00032C7.01832 1.04727 7.05552 1.1031 7.08062 1.16454C7.10572 1.22599 7.11842 1.29183 7.11782 1.35822C7.11722 1.42461 7.10342 1.49022 7.07722 1.55122C7.05102 1.61222 7.01292 1.6674 6.96522 1.71352L4.31871 4.36002L6.96522 7.00648C7.05632 7.10078 7.10672 7.22708 7.10552 7.35818C7.10442 7.48928 7.05182 7.61468 6.95912 7.70738C6.86642 7.80018 6.74102 7.85268 6.60992 7.85388C6.47882 7.85498 6.35252 7.80458 6.25822 7.71348L3.61171 5.06702L0.965207 7.71348C0.870907 7.80458 0.744606 7.85498 0.613506 7.85388C0.482406 7.85268 0.357007 7.80018 0.264297 7.70738C0.171597 7.61468 0.119017 7.48928 0.117877 7.35818C0.116737 7.22708 0.167126 7.10078 0.258206 7.00648L2.90471 4.36002L0.258206 1.71352C0.164476 1.61976 0.111816 1.4926 0.111816 1.36002C0.111816 1.22744 0.164476 1.10028 0.258206 1.00652Z",fill:"currentColor"})})]})]}),(0,s.jsx)("div",{className:"ti-modal-body",children:(0,s.jsx)("p",{className:"mt-1 text-gray-800 dark:text-white/70",children:"\xcates-vous s\xfbr de vouloir supprimer cet abonnement ?"})}),(0,s.jsxs)("div",{className:"ti-modal-footer",children:[(0,s.jsx)("button",{type:"button",className:"hs-dropdown-toggle ti-btn ti-btn-danger bg-danger font-medium shadow-sm align-middle hover:bg-danger/80 focus:ring-offset-white focus:ring-danger dark:bg-danger dark:hover:bg-danger/80 dark:focus:ring-offset-white/10","data-hs-overlay":"#deleteModal",onClick:P,children:"Supprimer"}),(0,s.jsx)("button",{type:"button",className:"hs-dropdown-toggle ti-btn ti-border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:ring-offset-white focus:ring-primary dark:bg-bgdark dark:hover:bg-black/20 dark:border-white/10 dark:text-white/70 dark:hover:text-white dark:focus:ring-offset-white/10","data-hs-overlay":"#deleteModal",children:"Annuler"})]})]})})})]})]})})})})},E=()=>{let[e,t]=(0,n.useState)("Abonnement"),[a,l]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(void 0),[h,b]=(0,n.useState)(void 0),[g,E]=(0,n.useState)(["LIBELLE","MONTANT","ANNEE_SCOLAIRE","DATE_ECHEANCE","TYPE_FRAIS"]),[x,p]=(0,n.useState)(!1),[A,f]=(0,n.useState)(""),C=(e,a)=>{t(e),d(!0),l(a)},v=(e,t,a,s)=>{let n=e.target.value.trim().toLowerCase();if(s.current){let e=n?a.filter(e=>t.some(t=>{var a;return null===(a=e[t])||void 0===a?void 0:a.toString().toLowerCase().includes(n)})):a;s.current.replaceData(e),s.current.redraw()}};return(0,s.jsxs)("div",{children:[(0,s.jsx)(i.A,{title:"Liste des abonnement"}),(0,s.jsx)(r.A,{currentpage:e,mainpage:a,activepage:"Gestion des Abonnements"}),(0,s.jsx)("div",{className:"grid grid-cols-12 gap-6",children:(0,s.jsxs)("div",{className:"col-span-12",children:[!o&&(0,s.jsxs)("div",{className:"box basic-data-table",children:[(0,s.jsxs)("div",{className:"box-header flex items-center ",children:[(0,s.jsxs)("button",{type:"button",className:"ti-btn !rounded-full ti-btn-outline-success mr-auto",onClick:()=>C("Ajouter un abonnement","Ajouter un abonnement"),children:[(0,s.jsx)("i",{className:"ti ti-plus font-bold"}),"Ajouter un abonnement"]}),(0,s.jsx)("div",{className:"max-w-sm space-y-3",children:(0,s.jsxs)("div",{className:"flex rounded-sm",children:[(0,s.jsx)("input",{onChange:e=>v(e,g,u,h),placeholder:"Rerchercher...",type:"text",id:"hs-trailing-button-add-on-with-icon",name:"hs-trailing-button-add-on-with-icon",className:"ti-form-input rounded-none ltr:rounded-l-sm rtl:rounded-r-sm focus:z-10"}),(0,s.jsx)("button",{"aria-label":"button",type:"button",className:"inline-flex flex-shrink-0 justify-center items-center h-[2.875rem] w-[2.875rem] ltr:rounded-r-sm rtl:rounded-l-sm border border-transparent font-semibold bg-primary text-white hover:bg-primary focus:z-10 focus:outline-none focus:ring-0 focus:ring-primary transition-all text-sm",children:(0,s.jsx)("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})})]})})]}),(0,s.jsx)(c,{namePage:t,isActif:d,mainPage:l,infoChecking:p,idCost:f,dataTable:m,refTable:b})]}),o&&(0,s.jsx)(N,{namePage:t,isActif:d,mainPage:l,isChecking:x,setInfoChecking:p,idCost:A,setIdCost:f})]})})]})};E.layout="Contentlayout";let x=E}},e=>{var t=t=>e(e.s=t);e.O(0,[374,833,518,718,150,552,476,230,30,636,593,792],()=>t(86470)),_N_E=e.O()}]);